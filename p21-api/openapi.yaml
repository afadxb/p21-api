openapi: 3.0.3
info:
  title: P21 API
  version: 1.0.0
servers:
  - url: http://localhost:3000
paths:
  /inventory:
    get:
      summary: List inventory items
      description: |
        Returns a paginated list of inventory records from the P21 database.
        The logic for this endpoint lives in `routes/inventory.js` and supports
        optional paging, sorting, and filtering of inactive items.
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
          description: Maximum number of records to return (default `100`).
        - in: query
          name: paging
          schema:
            type: boolean
          description: When `true`, enables SQL paging.
        - in: query
          name: page
          schema:
            type: integer
          description: Page number when `paging=true`.
        - in: query
          name: order
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order for the `item_id` column.
        - in: query
          name: inactive
          schema:
            type: boolean
          description: Include inactive items (`true` or `false`).
      responses:
        '200':
          description: Inventory list with paging metadata
  /inventory/{item_id}:
    get:
      summary: Get item by id
      description: |
        Retrieves a single inventory record. Implemented in
        `routes/inventory.js`.
      parameters:
        - in: path
          name: item_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Item details
        '404':
          description: Item not found
  /pricing/{item_id}:
    get:
      summary: Get pricing (placeholder)
      description: |
        Placeholder route implemented in `routes/pricing.js`. It simply returns
        a stubbed pricing response for the supplied `item_id`.
      parameters:
        - in: path
          name: item_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Pricing details
  /salesorders:
    post:
      summary: Export order to CSV
      description: |
        Exports an order to CSV files for downstream processing. The
        implementation resides in `routes/orders.js` and also records export
        status information in the `order_log` table.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [customer_id, sales_location_id, srx_order_id, lines]
              properties:
                customer_id:
                  type: string
                sales_location_id:
                  type: string
                srx_order_id:
                  type: string
                notes:
                  type: string
                lines:
                  type: array
                  items:
                    type: object
                    required: [item_id, qty]
                    properties:
                      item_id:
                        type: string
                      qty:
                        type: integer
                      notes:
                        type: string
      responses:
        '200':
          description: Paths to the generated CSV files are returned
  /orders:
    post:
      summary: Create sales order (placeholder)
      description: |
        Stub route found in `routes/salesorders.js`. In a full implementation it
        would create a sales order in P21, but it currently returns a placeholder
        response.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Placeholder response
  /salesorders/{order_id}:
    get:
      summary: Get export status
      description: |
        Looks up an order in the `order_log` table to report export status.
        Implemented in `routes/orders.js`.
      parameters:
        - in: path
          name: order_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order status
        '404':
          description: Order not found
  /orders/{order_id}:
    get:
      summary: Get sales order status
      description: |
        Retrieves a sales order header and its lines from P21. Each record is
        augmented with a `status` field derived from various flag columns.
        Implemented in `routes/salesorders.js`.
      parameters:
        - in: path
          name: order_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Sales order header and lines returned with status fields
        '404':
          description: Order not found


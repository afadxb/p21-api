openapi: 3.0.3
info:
  title: Accurate API
  version: "1.0.0"
servers:
  - url: https://api.accuratefasteners.com
paths:
  # --- keep your existing paths here ---
  /v1/sales/orders:
    post:
      tags: [Sales Orders]
      summary: Create Sales Order(s)
      description: Creates one or more sales orders by inserting header and line records.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/SalesOrder'
                - type: object
                  properties:
                    orders:
                      type: array
                      minItems: 1
                      items:
                        $ref: '#/components/schemas/SalesOrder'
                  required: [orders]
            examples:
              singleOrderMinimal:
                summary: Single order with only mandatory fields
                value:
                  header:
                    customerId: CUST-1001
                    warehouse: MAIN
                    approved: "Y"
                  lines:
                    - itemId: SKU-ABC-123
                      quantity: 5
              batchFull:
                summary: Batch insert with complete header/lines
                value:
                  orders:
                    - header:
                        customerId: CUST-1001
                        poNumber: PO-98765
                        warehouse: MAIN
                        approved: "Y"
                        quote: "N"
                        applyBuilderAllowanceFlag: "N"
                        willCall: "N"
                        orderDate: "2025-10-16"
                        # ... include any other non-derived header fields you accept ...
                      lines:
                        - itemId: SKU-ABC-123
                          uom: EA
                          quantity: 5
                          price: 10.5
                          taxItem: "N"
                          okToInterchange: "N"
                          scheduled: "N"
                          manualPriceOverride: "N"
                          commissionCostEdited: "N"
                          otherCostEdited: "N"
                          captureUsage: "N"
                        - itemId: SKU-XYZ-789
                          uom: EA
                          quantity: 2
                          price: 25
                          taxItem: "Y"
                          okToInterchange: "N"
                          scheduled: "N"
                          manualPriceOverride: "N"
                          commissionCostEdited: "N"
                          otherCostEdited: "N"
                          captureUsage: "N"
      responses:
        '201':
          description: Sales order(s) created successfully.
          content:
            application/json:
              schema:
                type: object
                required: [message, orders]
                properties:
                  message: { type: string }
                  orders:
                    type: array
                    items:
                      type: object
                      required: [importSetNo, linesInserted]
                      properties:
                        importSetNo:   { type: string }
                        linesInserted: { type: integer }
              examples:
                created:
                  summary: Created response
                  value:
                    message: Sales orders saved
                    orders:
                      - importSetNo: "12345"
                        linesInserted: 2
        '400': { description: Validation error (missing required fields or empty lines). }
        '401': { description: Unauthorized. }
        '500': { description: Server error. }

components:
  # --- keep your existing components here ---
  schemas:
    # keep any existing schemas untouched; the following are additive
    SalesOrderHeader:
      type: object
      description: Sales Order header (mapped to OE_HDR).
      properties:
        # Populate from your order.js/DB mapping; examples included for clarity
        customerId:
          type: string
          description: "DB column: CUSTOMER_ID Mandatory."
        poNumber:
          type: string
          description: "DB column: PO_NUMBER"
        warehouse:
          type: string
          description: "DB column: WHSE Mandatory."
        approved:
          type: string
          description: "DB column: APPROVED Flag Y/N Mandatory."
        quote:
          type: string
          description: "DB column: QUOTE Flag Y/N"
        applyBuilderAllowanceFlag:
          type: string
          description: "DB column: APPLY_BUILDER_ALLOWANCE Flag Y/N"
        willCall:
          type: string
          description: "DB column: WILL_CALL Flag Y/N"
        orderDate:
          type: string
          format: date
          description: "DB column: ORDER_DATE"
        # ... add the rest of your header fields, each with DB column and flags ...
      required:
        # Include only mandatory non-derived fields
        - customerId
        - warehouse
        - approved

    SalesOrderLine:
      type: object
      description: Sales Order line (mapped to OE_Line).
      properties:
        itemId:
          type: string
          description: "DB column: ITEM_ID Mandatory."
        uom:
          type: string
          description: "DB column: UOM"
        quantity:
          type: number
          format: double
          description: "DB column: QTY Mandatory."
        price:
          type: number
          format: double
          description: "DB column: PRICE"
        taxItem:
          type: string
          description: "DB column: TAX_ITEM Flag Y/N"
        okToInterchange:
          type: string
          description: "DB column: OK_TO_INTERCHANGE Flag Y/N"
        scheduled:
          type: string
          description: "DB column: SCHEDULED Flag Y/N"
        manualPriceOverride:
          type: string
          description: "DB column: MANUAL_PRICE_OVERRIDE Flag Y/N"
        commissionCostEdited:
          type: string
          description: "DB column: COMMISSION_COST_EDITED Flag Y/N"
        otherCostEdited:
          type: string
          description: "DB column: OTHER_COST_EDITED Flag Y/N"
        captureUsage:
          type: string
          description: "DB column: CAPTURE_USAGE Flag Y/N"
        # ... add any remaining line fields you accept ...
      required:
        - itemId
        - quantity

    SalesOrder:
      type: object
      description: Sales Order payload with header and lines.
      properties:
        header:
          $ref: '#/components/schemas/SalesOrderHeader'
        lines:
          type: array
          items:
            $ref: '#/components/schemas/SalesOrderLine'
      required: [header, lines]
